{% extends 'base.html' %}

{% block title %}Match Requests - Speakle{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="mb-8 text-center">
        <h1 class="text-3xl font-bold text-gray-900 mb-4">Match Requests</h1>
        <p class="text-lg text-gray-600">Manage your incoming and outgoing match requests</p>
        <div class="mt-4">
            <a href="{% url 'matches:find_matches' %}" 
               class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition">
                üîç Find Partners
            </a>
            <a href="{% url 'matches:my_matches' %}" 
               class="bg-purple-500 text-white px-4 py-2 rounded-md hover:bg-purple-600 transition ml-2">
                ü§ù My Matches
            </a>
        </div>
    </div>

    <!-- Incoming Requests -->
    <div class="mb-12">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">üì© Incoming Requests</h2>
        
        {% if incoming_requests %}
            <div class="space-y-4">
                {% for request in incoming_requests %}
                    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500">
                        <div class="flex items-center justify-between">
                            <!-- Request Info -->
                            <div class="flex items-center flex-1">
                                {% if request.sender.profile_picture %}
                                    <img src="{{ request.sender.profile_picture.url }}" 
                                         alt="{{ request.sender.username }}" 
                                         class="w-14 h-14 rounded-full object-cover mr-4">
                                {% else %}
                                    <div class="w-14 h-14 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold text-lg mr-4">
                                        {{ request.sender.username|first|upper }}
                                    </div>
                                {% endif %}
                                
                                <div class="flex-1">
                                    <h3 class="text-lg font-semibold text-gray-900">{{ request.sender.username }}</h3>
                                    <div class="flex items-center space-x-4 text-sm text-gray-600 mb-2">
                                        <span>Wants to learn: <strong class="text-blue-600">{{ request.sender_learns.name }} {{ request.sender_learns.flag_emoji }}</strong></span>
                                        <span>Can teach: <strong class="text-green-600">{{ request.sender_teaches.name }} {{ request.sender_teaches.flag_emoji }}</strong></span>
                                    </div>
                                    
                                    {% if request.message %}
                                        <div class="bg-gray-50 rounded-lg p-3 mt-2">
                                            <p class="text-sm text-gray-700">"{{ request.message }}"</p>
                                        </div>
                                    {% endif %}
                                    
                                    <p class="text-xs text-gray-500 mt-2">
                                        Sent {{ request.created_at|timesince }} ago
                                    </p>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex space-x-2 ml-4">
                                <form method="post" action="{% url 'matches:respond_request' request.id %}" class="inline">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="accept">
                                    <button type="submit" 
                                            class="bg-green-500 text-white px-4 py-2 rounded-md hover:bg-green-600 transition text-sm">
                                        ‚úÖ Accept
                                    </button>
                                </form>
                                <form method="post" action="{% url 'matches:respond_request' request.id %}" class="inline">
                                    {% csrf_token %}
                                    <input type="hidden" name="action" value="decline">
                                    <button type="submit" 
                                            class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 transition text-sm">
                                        ‚ùå Decline
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-8 bg-gray-50 rounded-lg">
                <div class="text-4xl mb-2">üì≠</div>
                <p class="text-gray-600">No incoming requests</p>
            </div>
        {% endif %}
    </div>

    <!-- Outgoing Requests -->
    <div>
        <h2 class="text-2xl font-bold text-gray-900 mb-6">üì§ Outgoing Requests</h2>
        
        {% if outgoing_requests %}
            <div class="space-y-4">
                {% for request in outgoing_requests %}
                    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 
                                {% if request.status == 'pending' %}border-yellow-500
                                {% elif request.status == 'accepted' %}border-green-500
                                {% else %}border-red-500{% endif %}">
                        
                        <div class="flex items-center justify-between">
                            <!-- Request Info -->
                            <div class="flex items-center flex-1">
                                {% if request.receiver.profile_picture %}
                                    <img src="{{ request.receiver.profile_picture.url }}" 
                                         alt="{{ request.receiver.username }}" 
                                         class="w-14 h-14 rounded-full object-cover mr-4">
                                {% else %}
                                    <div class="w-14 h-14 rounded-full bg-purple-500 flex items-center justify-center text-white font-bold text-lg mr-4">
                                        {{ request.receiver.username|first|upper }}
                                    </div>
                                {% endif %}
                                
                                <div class="flex-1">
                                    <h3 class="text-lg font-semibold text-gray-900">{{ request.receiver.username }}</h3>
                                    <div class="flex items-center space-x-4 text-sm text-gray-600 mb-2">
                                        <span>You teach: <strong class="text-blue-600">{{ request.sender_teaches.name }} {{ request.sender_teaches.flag_emoji }}</strong></span>
                                        <span>You learn: <strong class="text-green-600">{{ request.sender_learns.name }} {{ request.sender_learns.flag_emoji }}</strong></span>
                                    </div>
                                    
                                    {% if request.message %}
                                        <div class="bg-gray-50 rounded-lg p-3 mt-2">
                                            <p class="text-sm text-gray-700">"{{ request.message }}"</p>
                                        </div>
                                    {% endif %}
                                    
                                    <p class="text-xs text-gray-500 mt-2">
                                        Sent {{ request.created_at|timesince }} ago
                                        {% if request.responded_at %}
                                            ‚Ä¢ Responded {{ request.responded_at|timesince }} ago
                                        {% endif %}
                                    </p>
                                </div>
                            </div>

                            <!-- Status Badge -->
                            <div class="ml-4">
                                {% if request.status == 'pending' %}
                                    <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm">
                                        ‚è≥ Pending
                                    </span>
                                {% elif request.status == 'accepted' %}
                                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">
                                        ‚úÖ Accepted
                                    </span>
                                {% else %}
                                    <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm">
                                        ‚ùå Declined
                                    </span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-8 bg-gray-50 rounded-lg">
                <div class="text-4xl mb-2">üì§</div>
                <p class="text-gray-600">No outgoing requests</p>
                <a href="{% url 'matches:find_matches' %}" 
                   class="inline-block mt-4 bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition">
                    Find Partners
                </a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %} 